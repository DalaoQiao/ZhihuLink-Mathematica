 ZhihuLinkGetRaw::usage = "";ZhihuLinkGet::usage = "";ZhihuLinkUserAnswer::usage = "";ZhihuLinkUserArticle::usage = "";Begin["`Private`"];$APIURL = <|   "Miscellaneous" -> <|     "Scheme" -> "https",     "Domain" -> "www.zhihu.com",               "Profile" -> <|"Path" -> StringTemplate["api/v4/members/`id`"],        "RequireAuth" -> False|>,               "Topic" -> <|"Path" -> StringTemplate["api/v4/topics/`id`"],        "RequireAuth" -> False|>,               "Question" -> <|       "Path" -> StringTemplate["api/v4/questions/`id`"],        "RequireAuth" -> False|>,               "Answer" -> <|"Path" -> StringTemplate["api/v4/answers/`id`"],        "RequireAuth" -> False|>,               "Messages" -> <|"Path" -> StringTemplate["api/v4/messages"],        "RequireAuth" -> True|>,               "Notifications" -> <|       "Path" -> StringTemplate["api/v4/default-notifications"],        "RequireAuth" -> True|>     |>,   "Members" -> <|     "Scheme" -> "https",     "Domain" -> "www.zhihu.com",               "Followees" -> <|       "Path" -> StringTemplate["api/v4/members/`id`/followees"],        "RequireAuth" -> False|>,               "Followers" -> <|       "Path" -> StringTemplate["api/v4/members/`id`/followers"],        "RequireAuth" -> False|>,               "FollowingQuestions" -> <|       "Path" ->         StringTemplate["api/v4/members/`id`/following-questions"],        "RequireAuth" -> False|>,               "FollowingTopics" -> <|       "Path" ->         StringTemplate[         "api/v4/members/`id`/following-topic-contributions"],        "RequireAuth" -> False|>,               "FollowingColumns" -> <|       "Path" ->         StringTemplate["api/v4/members/`id`/following-columns"],        "RequireAuth" -> False|>,               "FollowingFavlists" -> <|       "Path" ->         StringTemplate["api/v4/members/`id`/following-favlists"],        "RequireAuth" -> False|>,               "Questions" -> <|       "Path" -> StringTemplate["api/v4/members/`id`/questions"],        "RequireAuth" -> False|>,               "Answers" -> <|       "Path" -> StringTemplate["api/v4/members/`id`/answers"],        "RequireAuth" -> False|>,               "Pins" -> <|"Path" -> StringTemplate["api/v4/members/`id`/pins"],        "RequireAuth" -> False|>,               "Articles" -> <|       "Path" -> StringTemplate["api/v4/members/`id`/articles"],        "RequireAuth" -> False|>,               "Columns" -> <|       "Path" ->         StringTemplate["api/v4/members/`id`/column-contributions"],        "RequireAuth" -> False|>,               "Favlists" -> <|       "Path" -> StringTemplate["api/v4/members/`id`/favlists"],        "RequireAuth" -> False|>,               "Activities" -> <|       "Path" -> StringTemplate["api/v4/members/`id`/activities"],        "RequireAuth" -> True|>     |>,   "Questions" -> <|     "Scheme" -> "https",     "Domain" -> "www.zhihu.com",               "Followers" -> <|       "Path" ->         StringTemplate["api/v4/questions/`id`/concerned_followers"],        "RequireAuth" -> False|>,               "Comments" -> <|       "Path" -> StringTemplate["api/v4/questions/`id`/comments"],        "RequireAuth" -> False|>,          "Invitees" -> <|       "Path" -> StringTemplate["api/v4/questions/`id`/invitees"],        "RequireAuth" -> False|>,          "InvitationCandidates" -> <|       "Path" ->         StringTemplate["api/v4/questions/`id`/invitation-candidates"],        "RequireAuth" -> False|>     |>,   "Answers" -> <|     "Scheme" -> "https",     "Domain" -> "www.zhihu.com",               "Upvoters" -> <|       "Path" ->         StringTemplate["api/v4/answers/`id`/concerned_upvoters"],        "RequireAuth" -> False|>,               "Comments" -> <|       "Path" -> StringTemplate["api/v4/answers/`id`/comments"],        "RequireAuth" -> False|>     |>,   "Pins" -> <|     "Scheme" -> "https",     "Domain" -> "www.zhihu.com",               "Comments" -> <|       "Path" -> StringTemplate["api/v4/pins/`id`/comments"],        "RequireAuth" -> False|>     |>,   "Topics" -> <|     "Scheme" -> "https",     "Domain" -> "www.zhihu.com",               "Followers" -> <|       "Path" -> StringTemplate["api/v4/topics/`id`/followers"],        "RequireAuth" -> False|>     |>,   "Articles" -> <|     "Scheme" -> "https",     "Domain" -> "zhuanlan.zhihu.com",               "Upvoters" -> <|       "Path" -> StringTemplate["api/posts/`id`/likers"],        "RequireAuth" -> False|>,               "Comments" -> <|       "Path" -> StringTemplate["api/posts/`id`/comments"],        "RequireAuth" -> False|>     |>,   "Columns" -> <|     "Scheme" -> "https",     "Domain" -> "zhuanlan.zhihu.com",               "Followers" -> <|       "Path" -> StringTemplate["api/columns/`id`/followers"],        "RequireAuth" -> False|>,               "Posts" -> <|"Path" -> StringTemplate["api/columns/`id`/posts"],        "RequireAuth" -> False|>     |>   |>;ExportJSON[cat_, item_, name_String, content_,    OptionsPattern[{"CustomSavePath" -> None}]] :=   Module[{path},    If[(path = OptionValue["CustomSavePath"]) == None,     path = FileNameJoin[{$ZhihuLinkDirectory, cat, item}]];   If[! DirectoryQ[path], CreateDirectory[path]];    Export[FileNameJoin[{path, name <> ".json"}], content]   ];  ts[] := ToString@IntegerPart[1000 AbsoluteTime@Now];FixURL[url_String, "Members",    "FollowingQuestions" | "Answers" | "Questions" | "Articles" |     "Columns" | "FollowingColumns"] :=     "https://www.zhihu.com/api/v4" <> StringDrop[url, 21];  FixURL[url_String, _, _] := url;Options[ZhihuLinkGetRaw] = {"offset" -> 0,"limit" -> 20,"Extension" -> Nothing,"RequireAuth" -> False};ZhihuLinkGetRaw[cat_String, item_String, id_String,OptionsPattern[]] :=GeneralUtilities`ToAssociations[URLExecute[HTTPRequest[<|"Scheme" -> $APIURL[cat]["Scheme"],"Domain" -> $APIURL[cat]["Domain"],"Headers" -> {"Cookie" -> $ZhihuCookie,"authorization" ->If[$APIURL[cat][item]["RequireAuth"], $ZhihuAuth, Nothing]},"Path" -> {Evaluate[$APIURL[cat][item]["Path"][<|"id" -> id|>]]},"Query" -> {"limit" -> OptionValue@"limit","offset" -> OptionValue@"offset",Sequence@@OptionValue["Extension"]}|>], Authentication -> None]];ZhihuLinkGetRaw[url_String, OptionsPattern[]] :=GeneralUtilities`ToAssociations[URLExecute[HTTPRequest[url,<|"Headers" -> {"Cookie" -> $ZhihuCookie,"authorization" -> If[OptionValue["RequireAuth"], $ZhihuAuth, Nothing]}|>], Authentication -> None]];Options[ZhihuLinkGet] = {"Save" -> True, "CustomSavePath" -> None,    "CustomFilename" -> None, "Extension" -> Nothing};ZhihuLinkGet[cat_String, item_String, name_String, OptionsPattern[]] :=    Module[{current, data = {}, exportname, curURL,     saveQ = OptionValue["Save"]},         If[! (KeyExistsQ[$APIURL, cat] && KeyExistsQ[$APIURL[cat], item]),     Return[$Failed]];   current =     ZhihuLinkGetRaw[cat, item, name,      "Extension" -> OptionValue["Extension"]];   If[(exportname = OptionValue["CustomFilename"]) == None,     exportname = name];   If[! KeyExistsQ[current, "paging"],        If[! saveQ,     current,     ExportJSON[cat, item, exportname, current,       "CustomSavePath" -> OptionValue["CustomSavePath"]]]    ,            data = Join[data, current["data"]];    While[! current["paging"]["is_end"],     curURL = FixURL[current["paging"]["next"], cat, item];     current = ZhihuLinkGetRaw[curURL];     If[AssociationQ[current],      data = Join[data, current["data"]],      Echo[       StringTemplate["Unable to read from: `url`."][<|         "url" -> curURL|>]]];     ];    If[! saveQ,     data,     ExportJSON[cat, item, exportname, data,       "CustomSavePath" -> OptionValue["CustomSavePath"]]]    ]   ];Options[ZhihuLinkUserAnswer]={Extension->None,SortBy->"created",Save->True};ZhihuLinkUserAnswer[id_,OptionsPattern[]] := ZhihuLinkGet["Members", "Answers", id,"CustomSavePath" -> "post","CustomFilename" -> StringTemplate["`id`.answer.`ts`"][<|"id" -> id, "ts" -> ts[] |>],"Extension" -> {Switch[OptionValue[Extension],None,Nothing,Min,"include"->"data[*].content,voteup_count",All,"include"->"data[*].is_normal,suggest_edit,comment_count,collapsed_counts,reviewing_comments_count,can_comment,content,voteup_count,reshipment_settings,comment_permission,mark_infos,created_time,updated_time,relationship.voting,is_author,is_thanked,is_nothelp,upvoted_followees",_,OptionValue[Extension]],"sort_by"->OptionValue[SortBy]},"Save"->OptionValue[Save]];Options[ZhihuLinkUserArticle]={Extension->None,SortBy->"created",Save->True};ZhihuLinkUserArticle[id_,OptionsPattern[]] := ZhihuLinkGet["Members", "Articles", id,"CustomSavePath" -> "post","CustomFilename" -> StringTemplate["`id`.article.`ts`"][<|"id" -> id, "ts" -> ts[] |>],"Extension" -> {Switch[OptionValue[Extension],None,Nothing,Min,"include"->"data[*].content,voteup_count",All,"include"->"data[*].is_normal", _,OptionValue[Extension]],"sort_by"->OptionValue[SortBy]},"Save"->OptionValue[Save]];Options[ZhihuLinkUserFollowee]={Save->True};ZhihuLinkUserFollowee[id_,OptionsPattern[]] := ZhihuLinkGet["Members", "Followees", id,"CustomSavePath" -> "follow","CustomFilename" -> StringTemplate["`id`.followees.`ts`"][<|"id" -> id, "ts" -> ts[] |>],"Save"->OptionValue[Save]];Options[ZhihuLinkUserFollower]={Save->True};ZhihuLinkUserFollower[id_,OptionsPattern[]] := ZhihuLinkGet["Members", "Followers", id,"CustomSavePath" -> "follow","CustomFilename" -> StringTemplate["`id`.followers.`ts`"][<|"id" -> id, "ts" -> ts[] |>],"Save"->OptionValue[Save]];Options[ZhihuLinkUserFollowingQuestion]={Save->True};ZhihuLinkUserFollowingQuestion[id_,OptionsPattern[]] := ZhihuLinkGet["Members", "FollowingQuestions", id,   "CustomSavePath" -> "follow",    "CustomFilename" -> StringTemplate["`id`.questions.`ts`"][<|"id" -> id, "ts" -> ts[] |>],"Save"->OptionValue[Save]];Options[ZhihuLinkUserFollowingTopic]={Save->True};ZhihuLinkUserFollowingTopic[id_,OptionsPattern[]] := ZhihuLinkGet["Members", "FollowingTopics", id,   "CustomSavePath" -> "follow",    "CustomFilename" -> StringTemplate["`id`.topics.`ts`"][<|"id" -> id, "ts" -> ts[] |>],"Save"->OptionValue[Save]];Options[ZhihuLinkUserFollowingColumn]={Save->True};ZhihuLinkUserFollowingColumn[id_,OptionsPattern[]] := ZhihuLinkGet["Members", "FollowingColumns", id,"CustomSavePath" -> "follow","CustomFilename" -> StringTemplate["`id`.columns.`ts`"][<|"id" -> id, "ts" -> ts[] |>],"Save"->OptionValue[Save]];Options[ZhihuLinkUserFollowingFavlist]={Save->True};ZhihuLinkUserFollowingFavlist[id_,OptionsPattern[]] := ZhihuLinkGet["Members", "FollowingFavlists", id,"CustomSavePath" -> "follow","CustomFilename" -> StringTemplate["`id`.favlists.`ts`"][<|"id" -> id, "ts" -> ts[] |>],"Save"->OptionValue[Save]];End[];