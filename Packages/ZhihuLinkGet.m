ZhihuLinkGetRaw::usage = "";ZhihuLinkGet::usage = "";ZhihuLinkUserAnswer::usage = "";ZhihuLinkUserArticle::usage = "";ZhihuLinkUserFollowingFavlist::usage = "";ZhihuLinkUserFollowingColumn::usage = "";ZhihuLinkUserFollowingTopic::usage = "";ZhihuLinkUserFollowingQuestion::usage = "";ZhihuLinkUserFollower::usage = "";ZhihuLinkUserFollowee::usage = "";Begin["`Private`"];$APIURL = <|"Miscellaneous" -> <|"Scheme" -> "https","Domain" -> "www.zhihu.com","Profile" -> <|"Path" -> StringTemplate["api/v4/members/`id`"]|>,"Topic" -> <|"Path" -> StringTemplate["api/v4/topics/`id`"]|>,"Question" -> <|"Path" -> StringTemplate["api/v4/questions/`id`"]|>,"Answer" -> <|"Path" -> StringTemplate["api/v4/answers/`id`"]|>,"Messages" -> <|"Path" -> StringTemplate["api/v4/messages"]|>,"Notifications" -> <|"Path" -> StringTemplate["api/v4/default-notifications"]|>|>,"Members" -> <|"Scheme" -> "https","Domain" -> "www.zhihu.com","Followees" -> <|"Path" -> StringTemplate["api/v4/members/`id`/followees"]|>,"Followers" -> <|"Path" -> StringTemplate["api/v4/members/`id`/followers"]|>,"FollowingQuestions" -> <|"Path" -> StringTemplate["api/v4/members/`id`/following-questions"]|>,"FollowingTopics" -> <|"Path" -> StringTemplate["api/v4/members/`id`/following-topic-contributions"]|>,"FollowingColumns" -> <|"Path" -> StringTemplate["api/v4/members/`id`/following-columns"]|>,"FollowingFavlists" -> <|"Path" -> StringTemplate["api/v4/members/`id`/following-favlists"]|>,"Questions" -> <|"Path" -> StringTemplate["api/v4/members/`id`/questions"]|>,"Answers" -> <|"Path" -> StringTemplate["api/v4/members/`id`/answers"]|>,"Pins" -> <|"Path" -> StringTemplate["api/v4/members/`id`/pins"]|>,"Articles" -> <|"Path" -> StringTemplate["api/v4/members/`id`/articles"]|>,"Columns" -> <|"Path" -> StringTemplate["api/v4/members/`id`/column-contributions"]|>,"Favlists" -> <|"Path" -> StringTemplate["api/v4/members/`id`/favlists"]|>,"Activities" -> <|"Path" -> StringTemplate["api/v4/members/`id`/activities"]|>|>,"Questions" -> <|"Scheme" -> "https","Domain" -> "www.zhihu.com","Followers" -> <|"Path" -> StringTemplate["api/v4/questions/`id`/concerned_followers"]|>,"Comments" -> <|"Path" -> StringTemplate["api/v4/questions/`id`/comments"]|>,"Invitees" -> <|"Path" -> StringTemplate["api/v4/questions/`id`/invitees"]|>,"InvitationCandidates" -> <|"Path" ->StringTemplate["api/v4/questions/`id`/invitation-candidates"]|>|>,"Answers" -> <|"Scheme" -> "https","Domain" -> "www.zhihu.com","Upvoters" -> <|"Path" ->StringTemplate["api/v4/answers/`id`/concerned_upvoters"]|>,"Comments" -> <|"Path" -> StringTemplate["api/v4/answers/`id`/comments"]|>|>,"Pins" -> <|"Scheme" -> "https","Domain" -> "www.zhihu.com","Comments" -> <|"Path" -> StringTemplate["api/v4/pins/`id`/comments"]|>|>,"Topics" -> <|"Scheme" -> "https","Domain" -> "www.zhihu.com","Followers" -> <|"Path" -> StringTemplate["api/v4/topics/`id`/followers"]|>|>,"Articles" -> <|"Scheme" -> "https","Domain" -> "zhuanlan.zhihu.com","Upvoters" -> <|"Path" -> StringTemplate["api/posts/`id`/likers"]|>,"Comments" -> <|"Path" -> StringTemplate["api/posts/`id`/comments"]|>|>,"Columns" -> <|"Scheme" -> "https","Domain" -> "zhuanlan.zhihu.com","Followers" -> <|"Path" -> StringTemplate["api/columns/`id`/followers"]|>,"Posts" -> <|"Path" -> StringTemplate["api/columns/`id`/posts"]|>|>|>;ExportJSON[cat_, item_, name_String, content_,OptionsPattern[{"CustomSavePath" -> None}]] :=Module[{path},If[(path = OptionValue["CustomSavePath"]) === None,path = FileNameJoin[{$ZhihuLinkDirectory, cat, item}],path = FileNameJoin[{$ZhihuLinkDirectory, path}]];If[! DirectoryQ[path], CreateDirectory[path]];Export[FileNameJoin[{path, name <> ".json"}], content]];  ts[] := ToString@IntegerPart[1000 AbsoluteTime@Now];FixURL[url_String,"Members","FollowingQuestions" | "Answers" | "Questions" |     "Articles" |"Columns" | "FollowingColumns"] := "https://www.zhihu.com/api/v4" <> StringDrop[url, 21];  FixURL[url_String, _, _] := url;Options[ZhihuLinkGetRaw] = {"offset" -> 0,"limit" -> 20,"Extension" -> Nothing};ZhihuLinkGetRaw[cat_String, item_String, id_String,OptionsPattern[]] :=GeneralUtilities`ToAssociations[URLExecute[HTTPRequest[<|"Scheme" -> $APIURL[cat]["Scheme"],"Domain" -> $APIURL[cat]["Domain"],"Headers" -> {"authorization" -> $ZhihuAuth},"Cookies" -> $ZhihuCookie,"Path" -> {Evaluate[$APIURL[cat][item]["Path"][<|"id" -> id|>]]},"Query" -> {"limit" -> OptionValue@"limit","offset" -> OptionValue@"offset",Sequence@@OptionValue["Extension"]}|>],Authentication -> None,Interactive -> False]];ZhihuLinkGetRaw[url_String, OptionsPattern[]] :=GeneralUtilities`ToAssociations[URLExecute[HTTPRequest[url,<|"Headers" -> {"authorization" -> $ZhihuAuth},"Cookies" -> $ZhihuCookie|>],Authentication -> None,Interactive -> False]];Options[ZhihuLinkGet] = {"Save" -> True,"CustomSavePath" -> None,"CustomFilename" -> None,"Extension" -> Nothing};ZhihuLinkGet[cat_String, item_String, name_String, OptionsPattern[]] := Module[{current, data = {}, exportname, curURL,saveQ = OptionValue["Save"]},If[! (KeyExistsQ[$APIURL, cat] && KeyExistsQ[$APIURL[cat], item]),Return[$Failed]];current = ZhihuLinkGetRaw[cat, item, name,"Extension" -> OptionValue["Extension"]];If[(exportname = OptionValue["CustomFilename"]) == None,exportname = name];If[! KeyExistsQ[current, "paging"],If[!saveQ,current,ExportJSON[cat, item, exportname, current,"CustomSavePath" -> OptionValue["CustomSavePath"]]],data = Join[data, current["data"]];While[! current["paging"]["is_end"],curURL = FixURL[current["paging"]["next"], cat, item];current = ZhihuLinkGetRaw[curURL];If[AssociationQ[current],data = Join[data, current["data"]],Echo[StringTemplate["Unable to read from: `url`."][<|"url" -> curURL|>]]];];If[!saveQ,data,ExportJSON[cat, item, exportname, data,"CustomSavePath" -> OptionValue["CustomSavePath"]]]]];Options[ZhihuLinkUserAnswer]={Extension->None,SortBy->"created",Save->True};ZhihuLinkUserAnswer[id_,OptionsPattern[]] := ZhihuLinkGet["Members", "Answers", id,"CustomSavePath" -> "post","CustomFilename" -> StringTemplate["`id`.answer.`ts`"][<|"id" -> id, "ts" -> ts[] |>],"Extension" -> {Switch[OptionValue[Extension],None,Nothing,Min,"include"->"data[*].content,voteup_count",All,"include"->"data[*].is_normal,suggest_edit,comment_count,can_comment,content,voteup_count,reshipment_settings,comment_permission,mark_infos,created_time,updated_time,relationship,voting,is_author,is_thanked,is_nothelp,upvoted_followees",_,  "include"->OptionValue[Extension]],"sort_by"->OptionValue[SortBy]},"Save"->OptionValue[Save]];Options[ZhihuLinkUserArticle]={Extension->None,SortBy->"created",Save->True};ZhihuLinkUserArticle[id_,OptionsPattern[]] := ZhihuLinkGet["Members", "Articles", id,"CustomSavePath" -> "post","CustomFilename" -> StringTemplate["`id`.article.`ts`"][<|"id" -> id, "ts" -> ts[] |>],"Extension" -> {Switch[OptionValue[Extension],None,Nothing,Min,"include"->"data[*].content,voteup_count",All,"include"->"data[*].is_normal,suggest_edit,comment_count,can_comment,content,voteup_count,comment_permission,created,updated,voting,upvoted_followees",_,  "include"->OptionValue[Extension]],"sort_by"->OptionValue[SortBy]},"Save"->OptionValue[Save]];Options[ZhihuLinkUserFollowee]={Save->True};ZhihuLinkUserFollowee[id_,OptionsPattern[]] := ZhihuLinkGet["Members", "Followees", id,"CustomSavePath" -> "follow","CustomFilename" -> StringTemplate["`id`.followees.`ts`"][<|"id" -> id, "ts" -> ts[] |>],"Extension" -> {Switch[OptionValue[Extension],None,Nothing,Min,"include"->"data[*].follower_count,voteup_count,favorited_count,thanked_count",All,"include"->"data[*].answer_count",_,  "include"->OptionValue[Extension]],"sort_by"->OptionValue[SortBy]},"Save"->OptionValue[Save]];Options[ZhihuLinkUserFollower]={Save->True};ZhihuLinkUserFollower[id_,OptionsPattern[]] := ZhihuLinkGet["Members", "Followers", id,"CustomSavePath" -> "follow","CustomFilename" -> StringTemplate["`id`.followers.`ts`"][<|"id" -> id, "ts" -> ts[] |>],"Extension" -> {Switch[OptionValue[Extension],None,Nothing,Min,"include"->"data[*].follower_count,voteup_count,favorited_count,thanked_count",All,"include"->"data[*].answer_count",_,  "include"->OptionValue[Extension]],"sort_by"->OptionValue[SortBy]},"Save"->OptionValue[Save]];Options[ZhihuLinkUserFollowingQuestion]={Save->True};ZhihuLinkUserFollowingQuestion[id_,OptionsPattern[]] := ZhihuLinkGet["Members", "FollowingQuestions", id,"CustomSavePath" -> "follow","CustomFilename" -> StringTemplate["`id`.questions.`ts`"][<|"id" -> id, "ts" -> ts[] |>],"Save"->OptionValue[Save]];Options[ZhihuLinkUserFollowingTopic]={Save->True};ZhihuLinkUserFollowingTopic[id_,OptionsPattern[]] := ZhihuLinkGet["Members", "FollowingTopics", id,"CustomSavePath" -> "follow", "CustomFilename" -> StringTemplate["`id`.topics.`ts`"][<|"id" -> id, "ts" -> ts[] |>],"Save"->OptionValue[Save]];Options[ZhihuLinkUserFollowingColumn]={Save->True};ZhihuLinkUserFollowingColumn[id_,OptionsPattern[]] := ZhihuLinkGet["Members", "FollowingColumns", id,"CustomSavePath" -> "follow","CustomFilename" -> StringTemplate["`id`.columns.`ts`"][<|"id" -> id, "ts" -> ts[] |>],"Save"->OptionValue[Save]];Options[ZhihuLinkUserFollowingFavlist]={Save->True};ZhihuLinkUserFollowingFavlist[id_,OptionsPattern[]] := ZhihuLinkGet["Members", "FollowingFavlists", id,"CustomSavePath" -> "follow","CustomFilename" -> StringTemplate["`id`.favlists.`ts`"][<|"id" -> id, "ts" -> ts[] |>],"Save"->OptionValue[Save]];End[];