$ZhihuLinkMarkdown::usage = "ZhihuLink \:7684\:7f13\:5b58\:76ee\:5f55.";$ZhihuLinkDirectory::usage = "ZhihuLink \:7684\:7f13\:5b58\:76ee\:5f55.";$ZhihuCookie::usage = "";$ZhihuAuth::usage = "";ZhihuLinkInit::usage = "";ZhihuCookieTransform::usage="ZhihuCookieTransform[cookieraw_] takes a string of cookie and convert it into a List of Association.";ZhihuKeyAddDialog::usage = "";
Begin["`Private`"];
Needs["Authentication`"];$ZhihuLinkDirectory=FileNameJoin[{$UserBaseDirectory,"ApplicationData","ZhihuLink"}];$ZhihuLinkMarkdown=FileNameJoin[{$UserBaseDirectory,"ApplicationData","HTML2Markdown","Zhihu"}];ZhihuConnectCookie::usage="";ZhihuLinkInit[] :=Block[{zc0},$ZhihuCookie = Import[FindFile["zhihu.cookie"]];zc0=Select[StringSplit[StringDelete[$ZhihuCookie," "],";"],StringTake[#,5]=="z_c0="&];$ZhihuAuth="Bearer "<>StringTake[First@zc0,6;;-1];];ZhihuKeyAddDialog[]:=Block[{},$CookieDialog$=None;$MarkDialog$=None;DialogInput[{TextCell["\:7c98\:8d34\:4f60\:7684 Cookies"],InputField[Dynamic@$CookieDialog$,String,FieldSize->100,ImageSize->{400,400/GoldenRatio^2}],TextCell["\:5907\:6ce8\:4fe1\:606f,\:6bd4\:5982\:53ef\:4ee5\:586b\:4f60\:7684\:7528\:6237\:540d(\:53ef\:4e0d\:586b)"],InputField[Dynamic@$MarkDialog$,String,FieldSize->32.5],DefaultButton[DialogReturn["Success"]]},WindowTitle->"\:9700\:8981Token"];{$CookieDialog$,$MarkDialog$}];ZhihuCookieTransform[cookieraw_String]:=Flatten@StringCases[StringSplit[cookieraw,";"],StartOfString~~name:Shortest[__]~~"="~~content__~~EndOfString:><|"Name"->StringDelete[name," "],"Content"->content|>];
End[];
SetAttributes[{},{Protected,ReadProtected}];