Html2Markdown::usage = "\:5c06HTML\:8f6c\:5316\:4e3aMarkdown\:683c\:5f0f\:7684\:65b9\:6848\:96c6\:5408.";H2MD::usage = "\:5c06HTML\:8f6c\:5316\:4e3aMarkdown\:683c\:5f0f.\rModule->\"Zhihu\", \:9488\:5bf9\:77e5\:4e4e\:56de\:7b54\:7684\:8f6c\:6362\:65b9\:6848\rModule->\"Zhuanlan\", \:9488\:5bf9\:77e5\:4e4e\:4e13\:680f\:7684\:8f6c\:6362\:65b9\:6848\rModule->\"WordPress\", \:9488\:5bf9 wp \:7684\:8f6c\:6362\:65b9\:6848\r";$DirectoryH2MD::usage = "\:6253\:5f00 Html2Markdown \:7684\:7f13\:5b58\:76ee\:5f55.";
Begin["`Private`"];
$dir=FileNameJoin[{$UserBaseDirectory,"ApplicationData","Html2Markdown"}];Quiet@CreateDirectory[$dir];$DirectoryH2MD[]:=SystemOpen@$dir;Options[H2MD]={Module->"Zhihu",Save->False};H2MD[input_String,OptionsPattern[]]:=Switch[OptionValue[Module],"Zhihu",ZhihuH2MD[input],"Zhuanlan",ZhuanlanH2MD[input]];Options[ZhihuH2MD]={Debug->False};ZhihuH2MD[input_String,OptionsPattern[]]:=Block[{xml,yu,body},xml=ImportString[input,{"HTML","XMLObject"}];yu=xml/.{XMLElement["p",{},{XMLElement["img",{"src"->__,"alt"->tex__,__},{}]}]:>StringJoin["\n$$",tex,"$$\n"],XMLElement["p",{},{para__}]:>StringJoin["\n",para,"\n"],XMLElement["img",{___,"data-original"->img__,___},{}]:>StringJoin["![](",img,")"],XMLElement["img",{___,"data-actualsrc"->img__,___},{}]:>StringJoin["![](",img,")"],XMLElement["noscript",___]:>Nothing,XMLElement["li",{},{li__}]:>StringJoin["> ",li,"\n"],XMLElement["a",{___,"href"->url_,___},{f__}]:>StringJoin["[",f,"](",url,")"],XMLElement["figcaption",{},{}]:>"\n\:56fe\:6ce8:",XMLElement["br",___]:>"\n",XMLElement["code",___,{__,code_}]:>StringJoin["\n```\n",code,"```\n"]};body=Part[yu/.{XMLElement["hr",{},{}]:>"\n---\n",XMLElement["figure",{},{}]:>Nothing,XMLElement["ul",{},{ul__}]:>StringJoin["\n",ul,"\n"],XMLElement["div",___,{XMLElement["pre",{},{raw_}]}]:>raw,XMLElement["blockquote",{},q_]:>StringJoin@Riffle[q,"> ",{1,-1,3}]},2,3,1];If[OptionValue[Debug],Return[body],StringJoin[ToString/@body[[3]]]]];
End[];
SetAttributes[{},{Protected,ReadProtected}];