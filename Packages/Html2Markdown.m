Html2Markdown::usage = "将HTML转化为Markdown格式的方案集合.";H2MD::usage = "将HTML转化为Markdown格式.\rModule->\"Zhihu\", 针对知乎回答的转换方案\rModule->\"Zhuanlan\", 针对知乎专栏的转换方案\rModule->\"WordPress\", 针对 wp 的转换方案\r";$DirectoryH2MD::usage = "打开 Html2Markdown 的缓存目录.";Begin["`Private`"];$dir=FileNameJoin[{$UserBaseDirectory,"ApplicationData","Html2Markdown"}];Quiet@CreateDirectory[$dir];$DirectoryH2MD[]:=SystemOpen@$dir;Options[H2MD]={Module->"Zhihu",Save->False};H2MD[input_String,OptionsPattern[]]:=Switch[OptionValue[Module],"Zhihu",ZhihuRule`ZhihuH2MD[input],"Zhuanlan",ZhuanlanRule`ZhuanlanH2MD[input]];Begin["ZhihuRule`"];ruleTexline=XMLElement["img",{"src"->__,"alt"->tex__,__},{}]:>StringJoin["$",tex,"$"];ruleTexdisplay=XMLElement["p",{},{XMLElement["img",{"src"->__,"alt"->tex__,__},{}]}]:>StringJoin["\n$$",tex,"$$\n"];rulePara=XMLElement["p",{},{para__}]:>StringJoin["\n",para,"\n"];ruleHr=XMLElement["hr",{},{}]:>"\n---\n";ruleF=XMLElement["figure",{},{}]:>Nothing;ruleS=XMLElement["noscript",___]:>Nothing;ruleImg1=XMLElement["img",{___,"data-original"->img__,___},{}]:>StringJoin["![](",img,")"];ruleImg2=XMLElement["img",{___,"data-actualsrc"->img__,___},{}]:>StringJoin["![](",img,")"];ruleLi=XMLElement["li",{},{li__}]:>StringJoin["> ",li,"\n"];ruleUl=XMLElement["ul",{},{ul__}]:>StringJoin["\n",ul,"\n"];ruleBq=XMLElement["blockquote",{},q_]:>StringJoin@Riffle[q,"> ",{1,-1,3}];ruleFc=XMLElement["figcaption",{},{}]:>"\n图注:";ruleA=XMLElement["a",{___,"href"->url_,___},{f__}]:>StringJoin["[",f,"](",url,")"];ruleBr=XMLElement["br",___]:>"\n";ruleCode1=XMLElement["code",___,{__,code_}]:>StringJoin["\n```\n",code,"```\n"];ruleCode2=XMLElement["div",___,{XMLElement["pre",{},{raw_}]}]:>raw;Options[ZhihuH2MD]={Debug->False};ZhihuH2MD[input_String,OptionsPattern[]]:=Block[{xml,yu,body},xml=ImportString[input,{"HTML","XMLObject"}];yu=xml/.{ruleTexdisplay,ruleTexline,ruleImg1,ruleImg2,ruleLi,ruleA,ruleFc,ruleBr,ruleCode1};body=Part[yu/.{rulePara,ruleHr,ruleF,ruleS,ruleUl,ruleCode2,ruleBq},2,3,1];If[OptionValue[Debug],Return[body],StringJoin[ToString/@body[[3]]]]];End[];End[];