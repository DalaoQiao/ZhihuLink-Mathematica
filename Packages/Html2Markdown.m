Html2Markdown::usage = "\:5c06HTML\:8f6c\:5316\:4e3aMarkdown\:683c\:5f0f\:7684\:65b9\:6848\:96c6\:5408.";H2MD::usage = "\:5c06HTML\:8f6c\:5316\:4e3aMarkdown\:683c\:5f0f.\rModule->\"Zhihu\", \:9488\:5bf9\:77e5\:4e4e\:56de\:7b54\:7684\:8f6c\:6362\:65b9\:6848\rModule->\"Zhuanlan\", \:9488\:5bf9\:77e5\:4e4e\:4e13\:680f\:7684\:8f6c\:6362\:65b9\:6848\rModule->\"WordPress\", \:9488\:5bf9 wp \:7684\:8f6c\:6362\:65b9\:6848\r";$DirectoryH2MD::usage = "\:6253\:5f00 Html2Markdown \:7684\:7f13\:5b58\:76ee\:5f55.";XMLShow::usage = "";
Begin["`Private`"];
$dir=FileNameJoin[{$UserBaseDirectory,"ApplicationData","Html2Markdown"}];Quiet@CreateDirectory[$dir];$DirectoryH2MD[]:=SystemOpen@$dir;Options[H2MD]={Module->"Zhihu",Save->False};H2MD[input_String,OptionsPattern[]]:=Switch[OptionValue[Module],"Zhihu",ZhihuH2MD[input],"Zhuanlan",ZhuanlanH2MD[input]];Options[ZhihuH2MD]={Debug->False};ZhihuH2MD[input_String,OptionsPattern[]]:=Block[{pre=input,xml,yu,body},xml=ImportString[pre,{"HTML","XMLObject"}];yu=xml/.{XMLElement["h1",{},{h__}]:>StringJoin["\n# ",h,"\n"],XMLElement["h2",{},{h__}]:>StringJoin["\n## ",h,"\n"],XMLElement["h3",{},{h__}]:>StringJoin["\n### ",h,"\n"],XMLElement["h4",{},{h__}]:>StringJoin["\n#### ",h,"\n"],XMLElement["h5",{},{h__}]:>StringJoin["\n##### ",h,"\n"],XMLElement["h6",{},{h__}]:>StringJoin["\n###### ",h,"\n"],XMLElement["a",{___,"href"->url_,___},{f_}]:>StringJoin["[",f,"](",url,")"],XMLElement["b",{},{b__}]:>StringJoin["**",b,"**"],XMLElement["figure",{},{}]->Nothing,XMLElement["figcaption",{},{}]->Nothing,XMLElement["noscript",___]->Nothing,XMLElement["img",{___,"data-actualsrc"->img__,___},{}]:>StringJoin["![](",img,")"],XMLElement["img",{"src"->__,"alt"->tex__,__},{}]:>StringJoin["$",tex,"$"],XMLElement["p",{},{XMLElement["img",{"src"->__,"alt"->tex__,__},{}]}]:>StringJoin["\n$$",tex,"$$\n"],XMLElement["br",___]:>"\n",XMLElement["hr",___]:>"\n---\n"};body=Part[yu/.{XMLElement["p",{},{para___}]:>StringJoin["\n",para,"\n"],XMLElement["blockquote",{},q_]:>StringJoin@Riffle[q,"> ",{1,-1,3}],XMLElement["ul",{},{ul__}]:>StringJoin["\n",ul,"\n"],XMLElement["div",___,{XMLElement["pre",{},{raw_}]}]:>raw,XMLElement["li",{},{li__}]:>StringJoin["> ",li,"\n"],XMLElement["code",___,{__,code_}]:>StringJoin["\n```\n",code,"```\n"]},2,3,1];If[OptionValue[Debug],Return[body],StringJoin[ToString/@body[[3]]]]];XMLNote[XMLElement[tag_,attributes_,data_], m_Integer]:=Cell[CellGroupData[{Cell[TextData[StyleBox[tag,FontFamily->"Swiss",FontWeight->"Bold",FontSize->15]]],Sequence@@(XMLNote[#1,m]&)/@attributes,Sequence@@(XMLNote[#1,m+30]&)/@data},Open],CellMargins->{{m,Inherited},{Inherited,Inherited}}];XMLNote[{an_String,a_String}->v_String,m_Integer]:=Cell[TextData[{StyleBox[an,FontColor->Hue[0.6]]," ",StyleBox[a,FontWeight->"Bold"]," = ",StyleBox[v,Background->GrayLevel[0.8]]}],CellMargins->{{m+5,Inherited},{Inherited,Inherited}}];XMLNote[a_String->v_String,m_Integer]:=Cell[TextData[{StyleBox[a,FontWeight->"Bold"]," = ",StyleBox[v,Background->GrayLevel[0.8]]}],CellMargins->{{m+5,Inherited},{Inherited,Inherited}}];XMLNote[s_String,m_Integer]:=Cell[s,Background->GrayLevel[0.9],CellMargins->{{m+25,Inherited},{Inherited,Inherited}}];XMLShow[input_String]:=NotebookPut@Notebook[{XMLNote[ImportString[input,{"HTML","XMLObject"}][[2]],0]},CellGrouping->"Manual"];
End[];
SetAttributes[{},{Protected,ReadProtected}];