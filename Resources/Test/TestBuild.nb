Notebook[{

Cell[CellGroupData[{
Cell[BoxData[{
 RowBox[{"time", "=", "Now"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"path", "=", 
   RowBox[{"ParentDirectory", "[", 
    RowBox[{
     RowBox[{"NotebookDirectory", "[", "]"}], ",", "2"}], "]"}]}], 
  ";"}]}], "Input",
 CellChangeTimes->{{3.729771288439731*^9, 3.729771293051919*^9}, {
  3.729771365116741*^9, 3.729771365669153*^9}, {3.73011016299809*^9, 
  3.7301101653627796`*^9}},
 CellLabel->"In[1]:=",ExpressionUUID->"7744e0f6-372a-4494-bae9-85454046f7d9"],

Cell[BoxData[
 TemplateBox[{RowBox[{"\"Sat 17 Mar 2018 23:10:27\"", 
     StyleBox[
      RowBox[{"\"GMT+\"", "\[InvisibleSpace]", 
        StyleBox["8.`", NumberMarks -> False, StripOnInput -> False]}], 
      FontColor -> GrayLevel[0.5]]}],RowBox[{"DateObject", "[", 
     RowBox[{
       RowBox[{"{", 
         RowBox[{
          "2018", ",", "3", ",", "17", ",", "23", ",", "10", ",", 
           "27.5055862`9.191995820600017"}], "}"}], ",", "\"Instant\"", ",", 
       "\"Gregorian\"", ",", "8.`"}], "]"}]},
  "DateObject",
  Editable->False]], "Output",
 CellLabel->"Out[1]=",ExpressionUUID->"acf52d10-cecf-4f0a-8845-9a627eb41f7d"]
}, Open  ]],

Cell["\<\
rawPath = FileNameJoin@{path, \"Packages\", \"__Raw\"};
all = Select[FileNames[\"*\", rawPath], StringPart[#, -1] == \"l\" &];
dQ = Or @@ {
     # == \"\",
     StringPart[#, {1, 2}] === {\"(\", \"*\"} && StringPart[#, {-2, -1}] === \
{\"*\", \")\"},
     StringContainsQ[#, \"BeginPackage\" ..] || StringContainsQ[#, \
\"EndPackage\" ..]
     } &;
build[file_] := Block[
   {mpkg, name},
   mpkg = DeleteCases[Import[file, \"List\", CharacterEncoding -> \"UTF8\"], \
_?dQ];
   name = FileNameJoin@{ParentDirectory@rawPath, FileBaseName[file] <> \".m\"};
   Export[name, mpkg, \"List\"];
   Print[FileBaseName[file] <> \" \:521b\:5efa\:5b8c\:6210!\"]
   ] // Quiet
build /@ all; // TT\
\>", "Program",
 CellLabel->"In[66]:=",ExpressionUUID->"cac4219d-5d77-47bc-800c-de5cde09f989"],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"rawPath", "=", 
   RowBox[{"FileNameJoin", "@", 
    RowBox[{"{", 
     RowBox[{"path", ",", "\"\<Packages\>\"", ",", "\"\<__Raw\>\""}], 
     "}"}]}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"all", "=", 
   RowBox[{"Select", "[", 
    RowBox[{
     RowBox[{"FileNames", "[", 
      RowBox[{"\"\<*\>\"", ",", "rawPath"}], "]"}], ",", 
     RowBox[{
      RowBox[{
       RowBox[{"StringPart", "[", 
        RowBox[{"#", ",", 
         RowBox[{"-", "1"}]}], "]"}], "\[Equal]", "\"\<l\>\""}], "&"}]}], 
    "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"drule", "=", 
   RowBox[{"{", 
    RowBox[{
    "\"\<\\n\>\"", ",", "\"\<\\r\>\"", ",", "\"\<\\t\>\"", ",", 
     "\"\<EndPackage[]\>\"", ",", 
     RowBox[{
     "RegularExpression", "[", "\"\<BeginPackage\\\\[((.*?))\\\\];\>\"", 
      "]"}], ",", 
     RowBox[{
     "RegularExpression", "[", "\"\<\\\\(\\\\*[\\\\w\\\\W]*?\\\\*\\\\)\>\"", 
      "]"}]}], "}"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"build", "[", "file_", "]"}], ":=", 
   RowBox[{
    RowBox[{"Block", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"mpkg", ",", "name"}], "}"}], ",", 
      RowBox[{
       RowBox[{"mpkg", "=", 
        RowBox[{"StringDelete", "[", 
         RowBox[{
          RowBox[{"Import", "[", 
           RowBox[{"file", ",", "\"\<Text\>\""}], "]"}], ",", "drule"}], 
         "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"name", "=", 
        RowBox[{"FileNameJoin", "@", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"ParentDirectory", "@", "rawPath"}], ",", 
           RowBox[{
            RowBox[{"FileBaseName", "[", "file", "]"}], "<>", 
            "\"\<.m\>\""}]}], "}"}]}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"Export", "[", 
        RowBox[{"name", ",", "mpkg", ",", "\"\<List\>\""}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Print", "[", 
        RowBox[{"\"\<Building: \>\"", "<>", 
         RowBox[{"FileBaseName", "[", "file", "]"}]}], "]"}]}]}], "]"}], "//",
     "Quiet"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"build", "/@", "all"}], "//", "TT"}], ";"}]}], "Input",
 CellLabel->"In[3]:=",ExpressionUUID->"4dc14dd7-e4de-435d-bd5b-2349b7ef8282"],

Cell[CellGroupData[{

Cell[BoxData["\<\"Building: Html2Markdown\"\>"], "Print",
 CellLabel->
  "\:6b63\:5728\:8ba1\:7b97In[3]:=",ExpressionUUID->"6169eaf6-578e-4e65-9c9a-\
ecc47c97ea75"],

Cell[BoxData["\<\"Building: ZhihuLinkBackup\"\>"], "Print",
 CellLabel->
  "\:6b63\:5728\:8ba1\:7b97In[3]:=",ExpressionUUID->"27e25d50-bcfd-4756-9752-\
339e95225cab"],

Cell[BoxData["\<\"Building: ZhihuLinkGet\"\>"], "Print",
 CellLabel->
  "\:6b63\:5728\:8ba1\:7b97In[3]:=",ExpressionUUID->"4d5a54a8-ff41-48ad-9805-\
28646d377c2d"],

Cell[BoxData["\<\"Building: ZhihuLinkInit\"\>"], "Print",
 CellLabel->
  "\:6b63\:5728\:8ba1\:7b97In[3]:=",ExpressionUUID->"d8c00d83-f58b-426c-b8ff-\
a87133ac15ea"],

Cell[BoxData[
 RowBox[{
  TagBox["\<\"CPU Time: \"\>",
   "EchoLabel"], " ", 
  "0.03125`"}]], \
"Echo",ExpressionUUID->"0af042ee-f9d5-4e83-96ce-e24710bac782"],

Cell[BoxData[
 RowBox[{
  TagBox["\<\"All Time: \"\>",
   "EchoLabel"], " ", 
  "0.1262449947118778`"}]], \
"Echo",ExpressionUUID->"222ffeca-3acd-4f32-b40c-e8060851b62e"]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"info", "=", 
   RowBox[{"FileNameJoin", "@", 
    RowBox[{"{", 
     RowBox[{"path", ",", "\"\<PacletInfo.m\>\""}], "}"}]}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"foo", "=", 
   RowBox[{
    RowBox[{"StringReplace", "[", 
     RowBox[{"#", ",", 
      RowBox[{
       RowBox[{"\"\<.\>\"", "~~", 
        RowBox[{"n", ":", 
         RowBox[{"DigitCharacter", ".."}]}], "~~", "\"\<\\\"\>\""}], 
       "\[RuleDelayed]", 
       RowBox[{"\"\<.\>\"", "~~", 
        RowBox[{"ToString", "[", 
         RowBox[{
          RowBox[{"ToExpression", "[", "n", "]"}], "+", "1"}], "]"}], "~~", 
        "\"\<\\\"\>\""}]}]}], "]"}], "&"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"infoN", "=", 
   RowBox[{"StringReplace", "[", 
    RowBox[{
     RowBox[{"Import", "[", 
      RowBox[{"info", ",", "\"\<String\>\""}], "]"}], ",", 
     RowBox[{
      RowBox[{"\"\<Version\>\"", "~~", "x__", "~~", "\"\<\\\",\>\""}], 
      "\[RuleDelayed]", 
      RowBox[{"\"\<Version\>\"", "~~", 
       RowBox[{"foo", "[", "x", "]"}], "~~", "\"\<\\\",\>\""}]}]}], "]"}]}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{"Export", "[", 
   RowBox[{"info", ",", "infoN", ",", "\"\<String\>\""}], "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"paclet", "=", 
   RowBox[{
    RowBox[{"PackPaclet", "@", "path"}], "//", "TT"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"SystemOpen", "[", 
   RowBox[{"DirectoryName", "[", 
    RowBox[{"AbsoluteFileName", "[", "paclet", "]"}], "]"}], "]"}], 
  ";"}]}], "Input",
 CellChangeTimes->{{3.7297728895119824`*^9, 3.7297729650171385`*^9}, {
   3.7297730025081434`*^9, 3.72977303691256*^9}, {3.729773139706052*^9, 
   3.729773186893263*^9}, {3.729773561682421*^9, 3.72977356270006*^9}, {
   3.7297737188628263`*^9, 3.7297737946528473`*^9}, {3.729773825999505*^9, 
   3.7297738541097183`*^9}, 3.729847528947226*^9, 3.7301003890139604`*^9, {
   3.7301102831269836`*^9, 3.730110289989846*^9}},
 CellLabel->"In[8]:=",ExpressionUUID->"0eca65f5-421d-4952-8f93-6a9d2a140173"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  TagBox["\<\"CPU Time: \"\>",
   "EchoLabel"], " ", 
  "0.046875`"}]], \
"Echo",ExpressionUUID->"8da08921-5e43-4c20-a266-369669ffa196"],

Cell[BoxData[
 RowBox[{
  TagBox["\<\"All Time: \"\>",
   "EchoLabel"], " ", 
  "0.42412512718785267`"}]], \
"Echo",ExpressionUUID->"f46c6a58-1b48-498a-8b8f-1d9f628d5f3d"]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"Echo", "[", 
   RowBox[{
    RowBox[{"Now", "-", "time"}], ",", "\"\<Time used: \>\""}], "]"}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.730101440514496*^9, 3.730101473242628*^9}},
 CellLabel->"In[14]:=",ExpressionUUID->"7a454ee7-1c78-4e4d-b243-838f0c4e73f8"],

Cell[BoxData[
 RowBox[{
  TagBox["\<\"Time used: \"\>",
   "EchoLabel"], " ", 
  TemplateBox[{"0.9306576999999999`","\"s\"","seconds","\"Seconds\""},
   "Quantity"]}]], \
"Echo",ExpressionUUID->"2e8f2e55-6eba-4bda-801e-6ab6a82a6d3a"]
}, Open  ]]
},
WindowSize->{775, 872},
WindowMargins->{{564, Automatic}, {Automatic, 54}},
PrivateNotebookOptions->{"FileOutlineCache"->False},
TrackCellChangeTimes->False,
FrontEndVersion->"11.3 for Microsoft Windows (64-bit) (2018\:5e743\:67086\
\:65e5)",
StyleDefinitions->"Default.nb"
]

