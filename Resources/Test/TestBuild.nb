Notebook[{

Cell[CellGroupData[{
Cell[BoxData[{
 RowBox[{"time", "=", "Now"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"path", "=", 
   RowBox[{"ParentDirectory", "[", 
    RowBox[{
     RowBox[{"NotebookDirectory", "[", "]"}], ",", "2"}], "]"}]}], 
  ";"}]}], "Input",
 CellChangeTimes->{{3.729771288439731*^9, 3.729771293051919*^9}, {
  3.729771365116741*^9, 3.729771365669153*^9}, {3.73011016299809*^9, 
  3.7301101653627796`*^9}},
 CellLabel->
  "In[213]:=",ExpressionUUID->"7744e0f6-372a-4494-bae9-85454046f7d9"],

Cell[BoxData[
 TemplateBox[{RowBox[{"\"Tue 20 Mar 2018 00:27:13\"", 
     StyleBox[
      RowBox[{"\"GMT+\"", "\[InvisibleSpace]", 
        StyleBox["8.`", NumberMarks -> False, StripOnInput -> False]}], 
      FontColor -> GrayLevel[0.5]]}],RowBox[{"DateObject", "[", 
     RowBox[{
       RowBox[{"{", 
         RowBox[{
          "2018", ",", "3", ",", "20", ",", "0", ",", "27", ",", 
           "13.625639`8.886931832185905"}], "}"}], ",", "\"Instant\"", ",", 
       "\"Gregorian\"", ",", "8.`"}], "]"}]},
  "DateObject",
  Editable->False]], "Output",
 CellLabel->"Out[213]=",ExpressionUUID->"9fb2b6ce-d51c-41b0-82ba-e719bfc2b7ff"]
}, Open  ]],

Cell["\<\
rawPath = FileNameJoin@{path, \"Packages\", \"__Raw\"};
all = Select[FileNames[\"*\", rawPath], StringPart[#, -1] == \"l\" &];
dQ = Or @@ {
     # == \"\",
     StringPart[#, {1, 2}] === {\"(\", \"*\"} && StringPart[#, {-2, -1}] === \
{\"*\", \")\"},
     StringContainsQ[#, \"BeginPackage\" ..] || StringContainsQ[#, \
\"EndPackage\" ..]
     } &;
build[file_] := Block[
   {mpkg, name},
   mpkg = DeleteCases[Import[file, \"List\", CharacterEncoding -> \"UTF8\"], \
_?dQ];
   name = FileNameJoin@{ParentDirectory@rawPath, FileBaseName[file] <> \".m\"};
   Export[name, mpkg, \"List\"];
   Print[FileBaseName[file] <> \" \:521b\:5efa\:5b8c\:6210!\"]
   ] // Quiet
build /@ all; // TT\
\>", "Program",
 CellLabel->"In[66]:=",ExpressionUUID->"cac4219d-5d77-47bc-800c-de5cde09f989"],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"rawPath", "=", 
   RowBox[{"FileNameJoin", "@", 
    RowBox[{"{", 
     RowBox[{"path", ",", "\"\<Packages\>\"", ",", "\"\<__Raw\>\""}], 
     "}"}]}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"all", "=", 
   RowBox[{"Select", "[", 
    RowBox[{
     RowBox[{"FileNames", "[", 
      RowBox[{"\"\<*\>\"", ",", "rawPath"}], "]"}], ",", 
     RowBox[{
      RowBox[{
       RowBox[{"StringPart", "[", 
        RowBox[{"#", ",", 
         RowBox[{"-", "1"}]}], "]"}], "\[Equal]", "\"\<l\>\""}], "&"}]}], 
    "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"drule", "=", 
   RowBox[{"{", 
    RowBox[{
    "\"\<\\n\>\"", ",", "\"\<\\r\>\"", ",", "\"\<\\t\>\"", ",", 
     "\"\<EndPackage[]\>\"", ",", 
     RowBox[{
     "RegularExpression", "[", "\"\<BeginPackage\\\\[((.*?))\\\\];\>\"", 
      "]"}], ",", 
     RowBox[{
     "RegularExpression", "[", "\"\<\\\\(\\\\*[\\\\w\\\\W]*?\\\\*\\\\)\>\"", 
      "]"}]}], "}"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"build", "[", "file_", "]"}], ":=", 
   RowBox[{
    RowBox[{"Block", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"mpkg", ",", "name"}], "}"}], ",", 
      RowBox[{
       RowBox[{"mpkg", "=", 
        RowBox[{"StringDelete", "[", 
         RowBox[{
          RowBox[{"Import", "[", 
           RowBox[{"file", ",", "\"\<Text\>\""}], "]"}], ",", "drule"}], 
         "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"name", "=", 
        RowBox[{"FileNameJoin", "@", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"ParentDirectory", "@", "rawPath"}], ",", 
           RowBox[{
            RowBox[{"FileBaseName", "[", "file", "]"}], "<>", 
            "\"\<.m\>\""}]}], "}"}]}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"Export", "[", 
        RowBox[{"name", ",", "mpkg", ",", "\"\<List\>\""}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Print", "[", 
        RowBox[{"\"\<Building: \>\"", "<>", 
         RowBox[{"FileBaseName", "[", "file", "]"}]}], "]"}]}]}], "]"}], "//",
     "Quiet"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"build", "/@", "all"}], "//", "TT"}], ";"}]}], "Input",
 CellLabel->
  "In[215]:=",ExpressionUUID->"4dc14dd7-e4de-435d-bd5b-2349b7ef8282"],

Cell[CellGroupData[{

Cell[BoxData["\<\"Building: Html2Markdown\"\>"], "Print",
 CellLabel->
  "\:6b63\:5728\:8ba1\:7b97In[215]:=",ExpressionUUID->"e1f84fb3-6e80-49a9-\
9588-af780ca46e32"],

Cell[BoxData["\<\"Building: ZhihuLinkBackup\"\>"], "Print",
 CellLabel->
  "\:6b63\:5728\:8ba1\:7b97In[215]:=",ExpressionUUID->"d74a43fa-877d-4a41-\
8e0f-c591c471f693"],

Cell[BoxData["\<\"Building: ZhihuLinkCookies\"\>"], "Print",
 CellLabel->
  "\:6b63\:5728\:8ba1\:7b97In[215]:=",ExpressionUUID->"d429dc74-d5f0-44cd-\
8a74-09d19a2a3820"],

Cell[BoxData["\<\"Building: ZhihuLinkGet\"\>"], "Print",
 CellLabel->
  "\:6b63\:5728\:8ba1\:7b97In[215]:=",ExpressionUUID->"e4675e38-509e-4ebf-\
afb8-711847ac2139"],

Cell[BoxData["\<\"Building: ZhihuLinkInit\"\>"], "Print",
 CellLabel->
  "\:6b63\:5728\:8ba1\:7b97In[215]:=",ExpressionUUID->"e266b4ea-5bc0-4e50-\
8fd6-d4db0bf5352d"],

Cell[BoxData["\<\"Building: ZhihuLinkObject\"\>"], "Print",
 CellLabel->
  "\:6b63\:5728\:8ba1\:7b97In[215]:=",ExpressionUUID->"d900aeb6-5759-4edd-\
a83d-82b7cd699d55"],

Cell[BoxData[
 RowBox[{
  TagBox["\<\"CPU Time: \"\>",
   "EchoLabel"], " ", 
  "0.03125`"}]], \
"Echo",ExpressionUUID->"eed0f55e-600c-49d7-a70d-f93a4214846a"],

Cell[BoxData[
 RowBox[{
  TagBox["\<\"All Time: \"\>",
   "EchoLabel"], " ", 
  "0.11851458583996234`"}]], \
"Echo",ExpressionUUID->"054fd138-7908-466a-982c-a2fb4c1f1f00"]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"info", "=", 
   RowBox[{"FileNameJoin", "@", 
    RowBox[{"{", 
     RowBox[{"path", ",", "\"\<PacletInfo.m\>\""}], "}"}]}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"foo", "=", 
   RowBox[{
    RowBox[{"StringReplace", "[", 
     RowBox[{"#", ",", 
      RowBox[{
       RowBox[{"\"\<.\>\"", "~~", 
        RowBox[{"n", ":", 
         RowBox[{"DigitCharacter", ".."}]}], "~~", "\"\<\\\"\>\""}], 
       "\[RuleDelayed]", 
       RowBox[{"\"\<.\>\"", "~~", 
        RowBox[{"ToString", "[", 
         RowBox[{
          RowBox[{"ToExpression", "[", "n", "]"}], "+", "1"}], "]"}], "~~", 
        "\"\<\\\"\>\""}]}]}], "]"}], "&"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"infoN", "=", 
   RowBox[{"StringReplace", "[", 
    RowBox[{
     RowBox[{"Import", "[", 
      RowBox[{"info", ",", "\"\<String\>\""}], "]"}], ",", 
     RowBox[{
      RowBox[{"\"\<Version\>\"", "~~", "x__", "~~", "\"\<\\\",\>\""}], 
      "\[RuleDelayed]", 
      RowBox[{"\"\<Version\>\"", "~~", 
       RowBox[{"foo", "[", "x", "]"}], "~~", "\"\<\\\",\>\""}]}]}], "]"}]}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{"Export", "[", 
   RowBox[{"info", ",", "infoN", ",", "\"\<String\>\""}], "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"paclet", "=", 
   RowBox[{
    RowBox[{"PackPaclet", "@", "path"}], "//", "TT"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"SystemOpen", "[", 
   RowBox[{"DirectoryName", "[", 
    RowBox[{"AbsoluteFileName", "[", "paclet", "]"}], "]"}], "]"}], 
  ";"}]}], "Input",
 CellChangeTimes->{{3.7297728895119824`*^9, 3.7297729650171385`*^9}, {
   3.7297730025081434`*^9, 3.72977303691256*^9}, {3.729773139706052*^9, 
   3.729773186893263*^9}, {3.729773561682421*^9, 3.72977356270006*^9}, {
   3.7297737188628263`*^9, 3.7297737946528473`*^9}, {3.729773825999505*^9, 
   3.7297738541097183`*^9}, 3.729847528947226*^9, 3.7301003890139604`*^9, {
   3.7301102831269836`*^9, 3.730110289989846*^9}},
 CellLabel->
  "In[220]:=",ExpressionUUID->"0eca65f5-421d-4952-8f93-6a9d2a140173"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  TagBox["\<\"CPU Time: \"\>",
   "EchoLabel"], " ", 
  "0.046875`"}]], \
"Echo",ExpressionUUID->"6c924948-fca9-4c40-814b-182c4ad6da08"],

Cell[BoxData[
 RowBox[{
  TagBox["\<\"All Time: \"\>",
   "EchoLabel"], " ", 
  "0.27713259214092206`"}]], \
"Echo",ExpressionUUID->"a848e69f-5583-40cb-967c-429f6eb80daf"]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"Echo", "[", 
   RowBox[{
    RowBox[{"Now", "-", "time"}], ",", "\"\<Time used: \>\""}], "]"}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.730101440514496*^9, 3.730101473242628*^9}},
 CellLabel->
  "In[226]:=",ExpressionUUID->"7a454ee7-1c78-4e4d-b243-838f0c4e73f8"],

Cell[BoxData[
 RowBox[{
  TagBox["\<\"Time used: \"\>",
   "EchoLabel"], " ", 
  TemplateBox[{"0.6447366`","\"s\"","seconds","\"Seconds\""},
   "Quantity"]}]], \
"Echo",ExpressionUUID->"f501325d-565d-4f67-bb35-15f3f482b71d"]
}, Open  ]]
},
WindowSize->{775, 872},
WindowMargins->{{564, Automatic}, {Automatic, 54}},
PrivateNotebookOptions->{"FileOutlineCache"->False},
TrackCellChangeTimes->False,
FrontEndVersion->"11.3 for Microsoft Windows (64-bit) (2018\:5e743\:67086\
\:65e5)",
StyleDefinitions->"Default.nb"
]

