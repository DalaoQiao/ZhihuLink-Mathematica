Notebook[{

Cell[CellGroupData[{
Cell[BoxData[{
 RowBox[{"time", "=", "Now"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"path", "=", 
   RowBox[{"ParentDirectory", "[", 
    RowBox[{
     RowBox[{"NotebookDirectory", "[", "]"}], ",", "2"}], "]"}]}], 
  ";"}]}], "Input",
 CellChangeTimes->{{3.729771288439731*^9, 3.729771293051919*^9}, {
  3.729771365116741*^9, 3.729771365669153*^9}, {3.73011016299809*^9, 
  3.7301101653627796`*^9}},
 CellLabel->"In[5]:=",ExpressionUUID->"7744e0f6-372a-4494-bae9-85454046f7d9"],

Cell[BoxData[
 TemplateBox[{RowBox[{"\"Mon 19 Mar 2018 22:12:57\"", 
     StyleBox[
      RowBox[{"\"GMT+\"", "\[InvisibleSpace]", 
        StyleBox["8.`", NumberMarks -> False, StripOnInput -> False]}], 
      FontColor -> GrayLevel[0.5]]}],RowBox[{"DateObject", "[", 
     RowBox[{
       RowBox[{"{", 
         RowBox[{
          "2018", ",", "3", ",", "19", ",", "22", ",", "12", ",", 
           "57.9575926`9.515685171458692"}], "}"}], ",", "\"Instant\"", ",", 
       "\"Gregorian\"", ",", "8.`"}], "]"}]},
  "DateObject",
  Editable->False]], "Output",
 CellLabel->"Out[5]=",ExpressionUUID->"cfddc00b-42bc-483c-bf9a-725c0f9dd88b"]
}, Open  ]],

Cell["\<\
rawPath = FileNameJoin@{path, \"Packages\", \"__Raw\"};
all = Select[FileNames[\"*\", rawPath], StringPart[#, -1] == \"l\" &];
dQ = Or @@ {
     # == \"\",
     StringPart[#, {1, 2}] === {\"(\", \"*\"} && StringPart[#, {-2, -1}] === \
{\"*\", \")\"},
     StringContainsQ[#, \"BeginPackage\" ..] || StringContainsQ[#, \
\"EndPackage\" ..]
     } &;
build[file_] := Block[
   {mpkg, name},
   mpkg = DeleteCases[Import[file, \"List\", CharacterEncoding -> \"UTF8\"], \
_?dQ];
   name = FileNameJoin@{ParentDirectory@rawPath, FileBaseName[file] <> \".m\"};
   Export[name, mpkg, \"List\"];
   Print[FileBaseName[file] <> \" \:521b\:5efa\:5b8c\:6210!\"]
   ] // Quiet
build /@ all; // TT\
\>", "Program",
 CellLabel->"In[66]:=",ExpressionUUID->"cac4219d-5d77-47bc-800c-de5cde09f989"],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"rawPath", "=", 
   RowBox[{"FileNameJoin", "@", 
    RowBox[{"{", 
     RowBox[{"path", ",", "\"\<Packages\>\"", ",", "\"\<__Raw\>\""}], 
     "}"}]}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"all", "=", 
   RowBox[{"Select", "[", 
    RowBox[{
     RowBox[{"FileNames", "[", 
      RowBox[{"\"\<*\>\"", ",", "rawPath"}], "]"}], ",", 
     RowBox[{
      RowBox[{
       RowBox[{"StringPart", "[", 
        RowBox[{"#", ",", 
         RowBox[{"-", "1"}]}], "]"}], "\[Equal]", "\"\<l\>\""}], "&"}]}], 
    "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"drule", "=", 
   RowBox[{"{", 
    RowBox[{
    "\"\<\\n\>\"", ",", "\"\<\\r\>\"", ",", "\"\<\\t\>\"", ",", 
     "\"\<EndPackage[]\>\"", ",", 
     RowBox[{
     "RegularExpression", "[", "\"\<BeginPackage\\\\[((.*?))\\\\];\>\"", 
      "]"}], ",", 
     RowBox[{
     "RegularExpression", "[", "\"\<\\\\(\\\\*[\\\\w\\\\W]*?\\\\*\\\\)\>\"", 
      "]"}]}], "}"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"build", "[", "file_", "]"}], ":=", 
   RowBox[{
    RowBox[{"Block", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"mpkg", ",", "name"}], "}"}], ",", 
      RowBox[{
       RowBox[{"mpkg", "=", 
        RowBox[{"StringDelete", "[", 
         RowBox[{
          RowBox[{"Import", "[", 
           RowBox[{"file", ",", "\"\<Text\>\""}], "]"}], ",", "drule"}], 
         "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"name", "=", 
        RowBox[{"FileNameJoin", "@", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"ParentDirectory", "@", "rawPath"}], ",", 
           RowBox[{
            RowBox[{"FileBaseName", "[", "file", "]"}], "<>", 
            "\"\<.m\>\""}]}], "}"}]}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"Export", "[", 
        RowBox[{"name", ",", "mpkg", ",", "\"\<List\>\""}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Print", "[", 
        RowBox[{"\"\<Building: \>\"", "<>", 
         RowBox[{"FileBaseName", "[", "file", "]"}]}], "]"}]}]}], "]"}], "//",
     "Quiet"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"build", "/@", "all"}], "//", "TT"}], ";"}]}], "Input",
 CellLabel->"In[7]:=",ExpressionUUID->"4dc14dd7-e4de-435d-bd5b-2349b7ef8282"],

Cell[CellGroupData[{

Cell[BoxData["\<\"Building: Html2Markdown\"\>"], "Print",
 CellLabel->
  "\:6b63\:5728\:8ba1\:7b97In[7]:=",ExpressionUUID->"7097116b-7a41-4abc-9ea9-\
fd3ab2524480"],

Cell[BoxData["\<\"Building: ZhihuLinkBackup\"\>"], "Print",
 CellLabel->
  "\:6b63\:5728\:8ba1\:7b97In[7]:=",ExpressionUUID->"eb80851f-0eca-401e-8b5b-\
cefcc1892793"],

Cell[BoxData["\<\"Building: ZhihuLinkCookies\"\>"], "Print",
 CellLabel->
  "\:6b63\:5728\:8ba1\:7b97In[7]:=",ExpressionUUID->"9b9ada63-7169-41d5-9a13-\
5d5161f4b7a3"],

Cell[BoxData["\<\"Building: ZhihuLinkGet\"\>"], "Print",
 CellLabel->
  "\:6b63\:5728\:8ba1\:7b97In[7]:=",ExpressionUUID->"b6e924ec-bae4-4840-9589-\
0edb212590f3"],

Cell[BoxData["\<\"Building: ZhihuLinkInit\"\>"], "Print",
 CellLabel->
  "\:6b63\:5728\:8ba1\:7b97In[7]:=",ExpressionUUID->"d3763149-b482-47b9-900b-\
2993736d8418"],

Cell[BoxData["\<\"Building: ZhihuLinkObject\"\>"], "Print",
 CellLabel->
  "\:6b63\:5728\:8ba1\:7b97In[7]:=",ExpressionUUID->"93064081-0f7b-4fc2-9b11-\
8c04abf85774"],

Cell[BoxData[
 RowBox[{
  TagBox["\<\"CPU Time: \"\>",
   "EchoLabel"], " ", 
  "0.09375`"}]], \
"Echo",ExpressionUUID->"dc6bf75e-2200-4e65-b748-081f2c8c99ee"],

Cell[BoxData[
 RowBox[{
  TagBox["\<\"All Time: \"\>",
   "EchoLabel"], " ", 
  "0.10685085909242108`"}]], \
"Echo",ExpressionUUID->"31245415-372a-4a3c-92fe-6b1e8c7220cf"]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"info", "=", 
   RowBox[{"FileNameJoin", "@", 
    RowBox[{"{", 
     RowBox[{"path", ",", "\"\<PacletInfo.m\>\""}], "}"}]}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"foo", "=", 
   RowBox[{
    RowBox[{"StringReplace", "[", 
     RowBox[{"#", ",", 
      RowBox[{
       RowBox[{"\"\<.\>\"", "~~", 
        RowBox[{"n", ":", 
         RowBox[{"DigitCharacter", ".."}]}], "~~", "\"\<\\\"\>\""}], 
       "\[RuleDelayed]", 
       RowBox[{"\"\<.\>\"", "~~", 
        RowBox[{"ToString", "[", 
         RowBox[{
          RowBox[{"ToExpression", "[", "n", "]"}], "+", "1"}], "]"}], "~~", 
        "\"\<\\\"\>\""}]}]}], "]"}], "&"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"infoN", "=", 
   RowBox[{"StringReplace", "[", 
    RowBox[{
     RowBox[{"Import", "[", 
      RowBox[{"info", ",", "\"\<String\>\""}], "]"}], ",", 
     RowBox[{
      RowBox[{"\"\<Version\>\"", "~~", "x__", "~~", "\"\<\\\",\>\""}], 
      "\[RuleDelayed]", 
      RowBox[{"\"\<Version\>\"", "~~", 
       RowBox[{"foo", "[", "x", "]"}], "~~", "\"\<\\\",\>\""}]}]}], "]"}]}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{"Export", "[", 
   RowBox[{"info", ",", "infoN", ",", "\"\<String\>\""}], "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"paclet", "=", 
   RowBox[{
    RowBox[{"PackPaclet", "@", "path"}], "//", "TT"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"SystemOpen", "[", 
   RowBox[{"DirectoryName", "[", 
    RowBox[{"AbsoluteFileName", "[", "paclet", "]"}], "]"}], "]"}], 
  ";"}]}], "Input",
 CellChangeTimes->{{3.7297728895119824`*^9, 3.7297729650171385`*^9}, {
   3.7297730025081434`*^9, 3.72977303691256*^9}, {3.729773139706052*^9, 
   3.729773186893263*^9}, {3.729773561682421*^9, 3.72977356270006*^9}, {
   3.7297737188628263`*^9, 3.7297737946528473`*^9}, {3.729773825999505*^9, 
   3.7297738541097183`*^9}, 3.729847528947226*^9, 3.7301003890139604`*^9, {
   3.7301102831269836`*^9, 3.730110289989846*^9}},
 CellLabel->"In[12]:=",ExpressionUUID->"0eca65f5-421d-4952-8f93-6a9d2a140173"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  TagBox["\<\"CPU Time: \"\>",
   "EchoLabel"], " ", 
  "0.03125`"}]], \
"Echo",ExpressionUUID->"59894cfc-a3df-488d-a2c2-be2aa8ad1f83"],

Cell[BoxData[
 RowBox[{
  TagBox["\<\"All Time: \"\>",
   "EchoLabel"], " ", 
  "0.2691586543956728`"}]], \
"Echo",ExpressionUUID->"9183d160-d14d-4bc1-b454-b9319375f3f4"]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"Echo", "[", 
   RowBox[{
    RowBox[{"Now", "-", "time"}], ",", "\"\<Time used: \>\""}], "]"}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.730101440514496*^9, 3.730101473242628*^9}},
 CellLabel->"In[18]:=",ExpressionUUID->"7a454ee7-1c78-4e4d-b243-838f0c4e73f8"],

Cell[BoxData[
 RowBox[{
  TagBox["\<\"Time used: \"\>",
   "EchoLabel"], " ", 
  TemplateBox[{"0.6367478`","\"s\"","seconds","\"Seconds\""},
   "Quantity"]}]], \
"Echo",ExpressionUUID->"a6473138-b8d3-467f-8b7b-0d005df8ebe9"]
}, Open  ]]
},
WindowSize->{775, 872},
WindowMargins->{{564, Automatic}, {Automatic, 54}},
PrivateNotebookOptions->{"FileOutlineCache"->False},
TrackCellChangeTimes->False,
FrontEndVersion->"11.3 for Microsoft Windows (64-bit) (2018\:5e743\:67086\
\:65e5)",
StyleDefinitions->"Default.nb"
]

